<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/dashboardstyles.css" />
  </head>
  <body>
    <aside>
      <div>
        <h1>Expense Tracker</h1>
        <div class="nav-link active">Dashboard</div>
        <div class="nav-link">Income</div>
        <div class="nav-link">Expense</div>
      </div>
      <button class="user-btn">User</button>
    </aside>

    <main>
      <div class="card-container">
        <!-- Income Card -->
        <div class="card" style="max-height: 220px; overflow-y: auto">
          <h3 class="summary-heading">Total Balance</h3>
          <div class="item-cards">
            <div class="summary-text">$300</div>
          </div>
        </div>
        <!-- Income Card -->
        <div class="card" style="max-height: 220px; overflow-y: auto">
          <h3 class="summary-heading">Montly Income</h3>
          <div class="item-cards">
            <div class="summary-text green">$300</div>
          </div>
        </div>

        <!-- Expenses Card -->
        <div class="card" style="max-height: 220px; overflow-y: auto">
          <h3 class="summary-heading">Monthly Expense</h3>
          <div class="item-cards">
            <div class="summary-text red">$300</div>
          </div>
        </div>
      </div>
      <h2 class="section-title">Transaction</h2>

      <!-- Top Section -->
      <div class="card-container">
        <!-- Recent Expenses -->
        <div class="card">
          <h3>Recent Transaction</h3>
          <div class="item-cards" id="recent-transaction">
            <div class="item-card income">
              ğŸ• Food - $15 <small>Apr 28</small>
            </div>
            <div class="item-card expense">
              ğŸšŒ Transport - $5 <small>Apr 27</small>
            </div>

            <div class="item-card">
              ğŸ“š Education - $30 <small>Apr 24</small>
            </div>
            <div class="item-card">ğŸ  Rent - $100 <small>Apr 23</small></div>
          </div>
        </div>

        <!-- Top Categories -->
        <div class="card">
          <h3>Top Categories</h3>
          <div class="item-cards">
            <div class="item-card income">ğŸ  Rent - $100</div>
            <div class="item-card expense">ğŸ“š Education - $30</div>
            <div class="item-card">ğŸ® Entertainment - $20</div>
          </div>
        </div>
      </div>

      <!-- All Expenses -->
      <div class="all-expenses">
        <div class="all-expenses-header">
          <h3>All Transaction</h3>
          <span>Sort By â–¾</span>
        </div>
        <div class="item-cards">
          <div class="item-card">ğŸ• Food - $15 <small>Apr 28</small></div>
          <div class="item-card">ğŸšŒ Transport - $5 <small>Apr 27</small></div>
          <div class="item-card">ğŸ“± Recharge - $10 <small>Apr 27</small></div>
          <div class="item-card">ğŸ’Š Health - $12 <small>Apr 26</small></div>
          <div class="item-card">
            ğŸ® Entertainment - $20 <small>Apr 25</small>
          </div>
          <div class="item-card">ğŸ“š Education - $30 <small>Apr 24</small></div>
          <div class="item-card">ğŸ  Rent - $100 <small>Apr 23</small></div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Check if token exists
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "/login.html";
      }

      // Setup axios with authorization header
      axios.defaults.headers.common["Authorization"] = `Bearer ${token}`;

      // Function to load summary data
      async function loadSummaryData() {
        try {
          const response = await axios.get("/api/summary");
          const { totalIncome, totalExpense, totalbalance } = response.data;

          // Update the UI
          document.querySelector(
            ".card:nth-child(1) .summary-text"
          ).textContent = `$${totalbalance}`;
          document.querySelector(
            ".card:nth-child(2) .summary-text"
          ).textContent = `$${totalIncome}`;
          document.querySelector(
            ".card:nth-child(3) .summary-text"
          ).textContent = `$${totalExpense}`;
        } catch (error) {
          console.error("Error loading summary data:", error);
          if (error.response && error.response.status === 401) {
            // Token expired or invalid
            localStorage.removeItem("token");
            window.location.href = "/login.html";
          }
        }
      }

      // Function to load recent transactions

      // Helper function to get emoji for category
      function getCategoryEmoji(category) {
        const emojis = {
          // Expense categories
          Food: "ğŸ•",
          Transportation: "ğŸšŒ",
          Health: "ğŸ’Š",
          Entertainment: "ğŸ®",
          Shopping: "ğŸ›ï¸",
          Insurance: "ğŸ“",
          Misc: "ğŸ“¦",
          Personal: "ğŸ‘¤",

          // Income categories
          Salary: "ğŸ’°",
          Business: "ğŸ’¼",
          Gifts: "ğŸ",
          Interest: "ğŸ’¹",
          Allowance: "ğŸ’µ",
          Other: "ğŸ”„",
        };

        return emojis[category] || "ğŸ“Š";
      }

      // Load data when page loads
      window.addEventListener("DOMContentLoaded", () => {
        loadSummaryData();
        loadRecentTransactions();

        // Add logout functionality
        document.querySelector(".user-btn").addEventListener("click", () => {
          localStorage.removeItem("token");
          window.location.href = "/login.html";
        });
      });
    </script>
  </body>
</html>
